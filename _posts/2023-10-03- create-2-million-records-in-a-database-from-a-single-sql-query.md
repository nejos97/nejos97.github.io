---
title: 'Create 2 Million records in a database from a single SQL query'
layout: post
date: '2023-10-03 2:11:00 PM'
categories:
- database
- sql
- postgres
- webdev
image: /assets/images/posts/create-2-million-records-in-a-database-from-a-single-sql-query.png
visible: 0
description: In this post, you'll learn how to generate a mass of data using WITH RECURSIVE clause.
---

Plus d'une fois en programmation ul vous ait arriver de travailler avec des donnnees mais d'une manier ou d'autre vous naviez pas ses donnees, cela peut autre pour tester la performance de vos requete, le comportement general de votre application ou pour preparer une demo.

Depuis un certain temps ceci ne devrait plus etre un probleme car beaucoup de base de donnees supporte les requete SQL recusrive. vous pouvez donc generer un quantite important de donnees(dite merci a la clause WITH RECURSIVE).

Pour ce post je vais essentiellement utiliser SQLite pour mes requete mais garder a l'esprit que cela fonctionne pour la plupart des SGBD courant que nous avons(MariaDB 10.2+, MySQL 8.0+, PostgreSQL 8.4+ and SQLite 3.8+. Oracle 11.2+ and SQL Server 2005+).

Pour notre premier example nous allons creer une table fake_data avec trois champs x, y, et z. Puis nous allons inserer 2 millions de ligne dans cette table avec des donnees numerique aleatoire pour chaque champs. Pour cet exemple il va pas avoir de contrainte sur les champs

```sql
CREATE TABLE fake_data AS
WITH RECURSIVE tmp(x, y, z) AS (
    SELECT random(), random(), random()
    UNION ALL
    SELECT random(), random(), random() FROM tmp
    LIMIT 1000000
)
SELECT * FROM tmp;
```

Of course! The given SQL query demonstrates how to create a new table filled with random data using a recursive common table expression (CTE). Let's break it down step by step:

CREATE TABLE fake_data AS:
This is an instruction to create a new table named fake_data. The structure of this table and the data it will contain are determined by the subsequent query.

WITH RECURSIVE:
This is used to define a recursive common table expression (CTE). A recursive CTE is a query that refers to itself, allowing for the generation of series, tree paths, and other complex use-cases in SQL.

tmp(x) AS ( ... ):
This defines the CTE named tmp with a single column x.

SELECT random():
This is the base case of the recursion. It selects a single row with a random value (between 0 and 1). The random() function generates a random float number between 0 and 1.

UNION ALL:
This operator is used to combine the results of two SELECT queries. In this context, it's used to combine the base case with the recursive case of the CTE.

SELECT random() FROM tmp:
This is the recursive case of the CTE. For each row in the current iteration of the tmp table, it generates a new row with a random value. Without any limiting condition, this would create an infinite number of rows. However, this recursion is constrained by the subsequent LIMIT clause.

LIMIT 1000000:
This limits the total number of rows generated by the recursive CTE to 1,000,000 rows.

SELECT * FROM tmp:
This is the main query, and it selects all the generated rows from the tmp CTE.

In summary, this SQL query creates a new table fake_data with a single column filled with 1,000,000 random float values between 0 and 1.
